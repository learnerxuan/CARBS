<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CARBS - Check Real-Time Availability</title>
    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/footer.css">
    <link rel="stylesheet" href="css/availability.css">
</head>
<body>
    <div id="header-placeholder"></div>
    <main>
        <section class="availability-container">
            <h2>Real-Time Resource Availability</h2>
            <p class="section-description">Select a date to view the availability of all resources, indicated by color-coded time slots.</p>

            <div class="date-selector">
                <label for="selectDay">Day:</label>
                <select id="selectDay"></select>

                <label for="selectMonth">Month:</label>
                <select id="selectMonth"></select>

                <label for="selectYear">Year:</label>
                <select id="selectYear"></select>

                <button class="btn" id="checkDateBtn">Go</button>
            </div>

            <div class="time-header-grid">
                <div class="resource-label-column"></div> <div class="time-slot-header">8 AM</div>
                <div class="time-slot-header">9 AM</div>
                <div class="time-slot-header">10 AM</div>
                <div class="time-slot-header">11 AM</div>
                <div class="time-slot-header">12 PM</div>
                <div class="time-slot-header">1 PM</div>
                <div class="time-slot-header">2 PM</div>
                <div class="time-slot-header">3 PM</div>
                <div class="time-slot-header">4 PM</div>
                <div class="time-slot-header">5 PM</div>
                <div class="time-slot-header">6 PM</div>
                </div>

            <div id="resourcesAvailability" class="resources-availability">
                <p class="initial-message">Select a date above to view resource availability.</p>
            </div>

            <div class="availability-legend">
                <span>Legend:</span>
                <span class="legend-item available">Available</span>
                <span class="legend-item occupied">Occupied</span>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 CARBS. All rights reserved.</p>
    </footer>

    <script src="js/load_header.js"></script>
    <script src="js/data.js"></script>
    <script>
        // --- PROTOTYPE-LEVEL JAVASCRIPT FOR AVAILABILITY SIMULATION ---
        // Now using window.mockData.resources and window.mockData.resourceBookings
        // from data.js

        // Get resource names dynamically from data.js
        // Filter out specific equipment if you only want rooms/vehicles in this view
        const resourcesToShow = window.mockData.resources.map(res => res.name);
        
        // Define the time slots (in 1-hour intervals for simplicity)
        const timeSlots = Array.from({ length: 11 }, (_, i) => {
            const hour = 8 + i;
            return `${String(hour).padStart(2, '0')}:00`;
        }); // 08:00, 09:00, ..., 18:00 (6 PM)

        document.addEventListener('DOMContentLoaded', function() {
            const selectDay = document.getElementById('selectDay');
            const selectMonth = document.getElementById('selectMonth');
            const selectYear = document.getElementById('selectYear');
            const checkDateBtn = document.getElementById('checkDateBtn');
            const resourcesAvailabilityDiv = document.getElementById('resourcesAvailability');

            // Populate Day dropdown (1-31)
            for (let i = 1; i <= 31; i++) {
                const option = document.createElement('option');
                option.value = String(i).padStart(2, '0');
                option.textContent = i;
                selectDay.appendChild(option);
            }

            // Populate Month dropdown
            const months = [
                "January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"
            ];
            months.forEach((month, index) => {
                const option = document.createElement('option');
                option.value = String(index + 1).padStart(2, '0');
                option.textContent = month;
                selectMonth.appendChild(option);
            });

            // Populate Year dropdown (e.g., current year +/- 2)
            const currentYear = new Date().getFullYear();
            for (let i = currentYear - 1; i <= currentYear + 2; i++) {
                const option = document.createElement('option');
                option.value = String(i);
                option.textContent = i;
                selectYear.appendChild(option);
            }

            // Set default date to today for convenience
            const today = new Date();
            selectDay.value = String(today.getDate()).padStart(2, '0');
            selectMonth.value = String(today.getMonth() + 1).padStart(2, '0');
            selectYear.value = String(today.getFullYear());

            checkDateBtn.addEventListener('click', displayAvailability);

            // Initial display on load
            displayAvailability();


            function displayAvailability() {
                const selectedDay = selectDay.value;
                const selectedMonth = selectMonth.value;
                const selectedYear = selectYear.value;
                const selectedDate = `${selectedYear}-${selectedMonth}-${selectedDay}`;

                resourcesAvailabilityDiv.innerHTML = ''; // Clear previous results
                resourcesAvailabilityDiv.classList.remove('initial-message'); // Remove initial message class

                if (!selectedDay || !selectedMonth || !selectedYear) {
                    resourcesAvailabilityDiv.innerHTML = '<p class="initial-message">Please select a complete date.</p>';
                    return;
                }

                resourcesToShow.forEach(resourceName => { // Iterate through the new resourcesToShow array
                    const resourceRow = document.createElement('div');
                    resourceRow.classList.add('resource-row');

                    const resourceNameDiv = document.createElement('div');
                    resourceNameDiv.classList.add('resource-name');
                    resourceNameDiv.textContent = resourceName;
                    resourceRow.appendChild(resourceNameDiv);

                    timeSlots.forEach(slotTime => {
                        const timeSlotDiv = document.createElement('div');
                        timeSlotDiv.classList.add('time-slot');
                        timeSlotDiv.classList.add('available'); // Default to available

                        // Check for bookings on this resource for the selected date and time slot
                        const booking = window.mockData.resourceBookings.find(b => // Use data from window.mockData
                            b.resourceName === resourceName && // Use resourceName as stored in mock data
                            b.date === selectedDate &&
                            // Check if the slot time falls within a booked period
                            slotTime >= b.startTime && slotTime < b.endTime
                        );

                        if (booking) {
                            timeSlotDiv.classList.remove('available');
                            timeSlotDiv.classList.add('occupied');
                            timeSlotDiv.title = `Booked by ${booking.bookedBy} (${booking.startTime}-${booking.endTime})`;
                        }

                        resourceRow.appendChild(timeSlotDiv);
                    });
                    resourcesAvailabilityDiv.appendChild(resourceRow);
                });
            }
        });
    </script>
</body>
</html>